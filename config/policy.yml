version: 1
enabled: true

# Roles (v1)
principals:
  owner:
    telegram_user_id: "REPLACE_ME"      # from.id
    telegram_owner_chat_id: "REPLACE_ME" # private chat_id (optional)
  allowlist:
    telegram_user_ids: []
    telegram_chat_ids: []

# Capability list
capabilities:
  - alerts.explain
  - ops.status
  - ops.logs
  - ops.ps

# Default policy: deny by default
default:
  allow: []
  rate_limit:
    rpm: 30
  output_limits:
    max_lines: 60
    max_chars: 6000

# Rules: match by channel + chat + user + conditions
rules:
  # 1) Owner DM: explain + ops (Phase A)
  - name: owner_dm_all
    match:
      channel: telegram
      chat_type: private
      user_id: "${principals.owner.telegram_user_id}"
    allow:
      - alerts.explain
      - ops.status
      - ops.logs
      - ops.ps
    require:
      mention_bot: false
      reply_required_for_explain: false
    rate_limit:
      rpm: 60
    output_limits:
      max_lines: 120
      max_chars: 9000

  # 2) Project group: commands no @; explain must @ + reply
  - name: project_group_ops_and_explain
    match:
      channel: telegram
      chat_id: "-5242302064"          # crypto agent group
      user_id: "${principals.owner.telegram_user_id}"
    allow:
      - alerts.explain
      - ops.status
      - ops.logs
      - ops.ps
    require:
      mention_bot_for_explain: true
      reply_required_for_explain: true
      mention_bot_for_ops: false
    rate_limit:
      rpm: 30
    output_limits:
      max_lines: 80
      max_chars: 8000

  # 3) Project group: non-owner deny
  - name: project_group_non_owner_deny
    match:
      channel: telegram
      chat_id: "-5242302064"
    allow: []
    deny_message: "ğŸš« æœªæˆæƒæ“ä½œ\næœ¬ç¾¤ Bot ä»…å¯¹é¡¹ç›® Owner å¼€æ”¾è§£é‡Šèƒ½åŠ›ã€‚"
